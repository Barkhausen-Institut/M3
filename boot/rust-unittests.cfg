#!/bin/sh
fs=build/$M3_TARGET-$M3_ISA-$M3_BUILD/$M3_FS
fssize=`stat --format="%s" $fs`
cat <<EOF
<config>
    <kernel args="kernel -f $fs" />
    <dom>
        <app args="root" />
    </dom>
    <dom>
        <app args="m3fs mem $fssize" daemon="1">
            <serv name="m3fs" />
            <mem addr="0" size="$fssize" />
        </app>
    </dom>
    <dom>
        <app args="pipes" daemon="1">
            <serv name="pipes" />
        </app>
    </dom>
    <dom>
        <app args="testmsgs" daemon="1">
            <serv name="testmsgs" />
        </app>
    </dom>
    <dom>
        <app args="testcaps" daemon="1">
            <serv name="testcaps" />
        </app>
    </dom>
    <dom>
        <app args="pager /bin/subsys /bin/rustunittests">
            <sess name="m3fs" />
            <sess lname="m3fs-clone" gname="m3fs" />
            <sess name="pipes" />
            <sess name="testmsgs" />
            <sess name="testcaps" />
            <pes type="core" count="4" />
        </app>
    </dom>
</config>
EOF
