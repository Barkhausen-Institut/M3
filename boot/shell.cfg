#!/bin/sh
fs=build/$M3_TARGET-$M3_ISA-$M3_BUILD/$M3_FS
fssize=`stat --format="%s" $fs`
cat <<EOF
<config>
    <kernel args="kernel -f $fs" />
    <dom>
        <app args="root" />
    </dom>
    <dom>
        <app args="m3fs mem $fssize" daemon="1">
            <serv name="m3fs" />
            <mem addr="0" size="$fssize" />
        </app>
    </dom>
    <dom>
        <app args="pipes" daemon="1">
            <serv name="pipes" />
        </app>
    </dom>
    <dom>
        <app args="vterm" daemon="1">
            <serv name="vterm" />
        </app>
    </dom>
    <dom>
        <app args="pager /bin/shell">
            <sess name="m3fs" />
            <sess name="pipes" />
            <sess name="vterm" />
            <mem size="128M" />
            <pes type="core" count="4" />
            <pes type="rot13" count="2" optional="1" />
        </app>
    </dom>
</config>
EOF
